(function(a,e){"function"===typeof define&&define.amd?define("jquery mooBehavior mooFileUploader mooAjax mooOverlay mooAlert mooPhrase mooGlobal tinyMCE mooUser mooButton picker_date tagsinput".split(" "),e):"object"===typeof exports?module.exports=e(require("jquery")):a.mooFundraising=e()})(this,function(a,e,h,n,p,k,b,l,f,q,m){var r=function(){a("#view_map").unbind("click");a("#view_map").click(function(){address=a(this).html();a("#campaignModal .modal-content").empty().append("");a("#campaignModal").modal();
    a.post(mooConfig.url.base+"/fundraisings/view_map","address="+address,function(b){a("#campaignModal .modal-content").empty().append(b)})})},g=function(){a(".deleteCampaign").unbind("click");a(".deleteCampaign").click(function(){var c=a(this).data();c=mooConfig.url.base+"/fundraisings/do_delete/"+c.id;k.confirm(b.__("are_you_sure_you_want_to_remove_this_campaign"),c)})};return{initOnCreate:function(){a("#saveBtn").unbind("click");a("#saveBtn").click(function(){a(this).addClass("disabled");null!==f.activeEditor&&
a("#editor").val(f.activeEditor.getContent());e.createItem("fundraisings",!0)});var c=new h.fineUploader({element:a("#attachments_upload")[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i>'+b.__("drag_or_click_here_to_upload_photo")+" </div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/fundraising/fundraising_upload/attachments/"+a("#plugin_campaign_id").val()},callbacks:{onError:l.errorHandler,
    onComplete:function(d,b,c){c.thumb&&(a("#campaign_photo_ids").val(a("#campaign_photo_ids").val()+","+c.photo_id),f.activeEditor.insertContent('<p align="center"><a href="'+c.large+'" class="attached-image"><img src="'+c.thumb+'"></a></p><br>'))}}});a("#triggerUpload").click(function(){c.uploadStoredFiles()});new h.fineUploader({element:a("#campaign_thumnail")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i>'+b.__("drag_or_click_here_to_upload_photo")+
"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/fundraising/fundraising_upload/avatar"},callbacks:{onError:l.errorHandler,onComplete:function(d,b,c){a("#campaign_thumnail_preview > img").attr("src",c.thumb);a("#campaign_thumnail_preview > img").show();a("#thumbnail").val(c.file_path)}}});g();a(".datepicker").pickadate({monthsFull:[b.__("january"),b.__("february"),b.__("march"),b.__("april"),b.__("may"),b.__("june"),b.__("july"),
    b.__("august"),b.__("september"),b.__("october"),b.__("november"),b.__("december")],monthsShort:[b.__("jan"),b.__("feb"),b.__("mar"),b.__("apr"),b.__("may"),b.__("jun"),b.__("jul"),b.__("aug"),b.__("sep"),b.__("oct"),b.__("nov"),b.__("dec")],weekdaysFull:[b.__("sunday"),b.__("monday"),b.__("tuesday"),b.__("wednesday"),b.__("thursday"),b.__("friday"),b.__("saturday")],weekdaysShort:[b.__("sun"),b.__("mon"),b.__("tue"),b.__("wed"),b.__("thu"),b.__("fri"),b.__("sat")],today:b.__("today"),clear:b.__("clear"),
    format:"yyyy-mm-dd",close:!1,onClose:function(){}});"undefined"!==typeof google.maps.places&&new google.maps.places.Autocomplete(document.getElementById("location"))},initOnView:function(){p.registerImageOverlay();g();r()},initOnListing:function(){e.initMoreResults();g();a(".likeItem").unbind("click");a(".likeItem").click(function(){var b=a(this),d=a(this).data(),e=d.type,f=d.id,g=d.status;b.hasClass("do_ajax")||(b.addClass("do_ajax"),a.post(mooConfig.url.base+"/likes/ajax_add/"+e+"/"+f+"/"+g,{noCache:1},
    function(d){try{var c=a.parseJSON(d);b.parents(".like-section:first").find(".likeCount:first").html(parseInt(c.like_count));b.parents(".like-section:first").find(".dislikeCount:first").html(parseInt(c.dislike_count));g?(b.toggleClass("active"),b.next().next().removeClass("active")):(b.toggleClass("active"),b.prev().prev().removeClass("active"))}catch(t){q.validateUser()}b.removeClass("do_ajax")}))})},toggleUploader:function(){a("#images-uploader").slideToggle()},initAjaxInvite:function(){var c=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},
    queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mooConfig.url.base+"/users/friends.json",cache:!1,filter:function(b){return a.map(b.data,function(a){return a})}},identify:function(a){return a.id}});c.initialize();a("#friends").tagsinput({freeInput:!1,itemValue:"id",itemText:"name",typeaheadjs:{name:"friends_userTagging",displayKey:"name",highlight:!0,limit:10,source:c.ttAdapter(),templates:{notFound:['<div class="empty-message">',b.__("no_results"),"</div>"].join(" "),suggestion:function(d){return""!=
a("#friends").val()&&-1!=a("#friends").val().split(",").indexOf(d.id)?'<div class="empty-message" style="display:none">'+b.__("no_results")+"</div>":['<div class="suggestion-item">','<img alt src="'+d.avatar+'"/>','<span class="text">'+d.name+"</span>","</div>"].join("")}}}});a("#sendButton").unbind("click");a("#sendButton").click(function(){a("#sendButton").spin("small");m.disableButton("sendButton");a(".error-message").hide();n.post({url:mooConfig.url.base+"/fundraisings/ajax_sendInvite",data:a("#sendInvite").serialize()},
    function(b){m.enableButton("sendButton");a("#sendButton").spin(!1);b=a.parseJSON(b);1==b.result?a("#simple-modal-body").html(b.msg):(a(".error-message").show(),a(".error-message").html(b.message))});return!1});a("#invite_type_topic").change(function(){a("#invite_friend").hide();a("#invite_email").hide();"1"==a("#invite_type_topic").val()?a("#invite_friend").show():a("#invite_email").show()})},initMailSetting:function(){a("#btn_save").on("click",function(){a("#content").val(f.activeEditor.getContent());
    a(this).spin("small");a.post(mooConfig.url.base+"/fundraisings/email_setting/",a("#formMailSetting").serialize(),function(b){b=a.parseJSON(b);"1"==b.result?(a("#msg_success").show(),a(".error-message").hide()):(a("#msg_success").hide(),a(".error-message").show(),a(".error-message").html(b.message));a("#btn_save").spin(!1)})})},initDonation:function(){a(".pre-item").unbind("click");a(".pre-item").click(function(){var b=a(this).data();a("#amount").val(b.value)});a("#view_term").click(function(b){b.preventDefault();
    k.alert(a("#term_content").html())});a("#btn_pay_offline").unbind("click");a("#btn_pay_offline").click(function(b){a(this).spin("small");a.post(mooConfig.url.base+"/fundraisings/pay_offline/",a("#formDonation").serialize(),function(b){b=a.parseJSON(b);"1"==b.result?a.post(mooConfig.url.base+"/fundraisings/pay_offline/",function(b){a("#pay_step_1 li").hide();a("#wrap_btn_payoffline").show();a("#wrap_errorMessage").show();a("#formDonation").prepend(b);a("#captcha").attr("style","display: flex;")}):
    (a("#msg_success").hide(),a(".error-message").show(),a(".error-message").html(b.message));a("#btn_pay_offline").spin(!1)})});a("#pay_step_1").on("click","#btn_send_payoffline",function(b){a(this).spin("small");a.post(mooConfig.url.base+"/fundraisings/pay_offline/1",a("#formDonation").serialize(),function(b){b=a.parseJSON(b);"1"==b.result?window.location=b.redirect:(a("#msg_success").hide(),a(".error-message").show(),a(".error-message").html(b.message));a("#btn_send_payoffline").spin(!1)})});a("#btn_pay_paypal").unbind("click");
    a("#btn_pay_paypal").click(function(b){a(this).spin("small");a.post(mooConfig.url.base+"/fundraisings/pay_paypal/",a("#formDonation").serialize(),function(b){b=a.parseJSON(b);"1"==b.result?(a("#paypal_amount").val(b.amount),a("#notify_url").val(b.notify_url),a("#cancel_return").val(b.cancel_url),a("#errorMessage").hide(),a("#paypal_form").submit()):(a("#msg_success").hide(),a(".error-message").show(),a(".error-message").html(b.message),a("#btn_pay_paypal").spin(!1))})})},initOnDonorListing:function(){e.initMoreResults()},
    initDeleteDonor:function(){a("#btn_delete_donor").unbind("click");a("#btn_delete_donor").click(function(b){a(this).spin("small");a.post(mooConfig.url.base+"/fundraisings/delete_donor/",a("#formDeleteDonor").serialize(),function(b){b=a.parseJSON(b);"1"==b.result?window.location.reload():(a(".error-message").show(),a(".error-message").html(b.message));a("#btn_delete_donor").spin(!1)})})},initReceiveDonor:function(){a("#btn_receive_donor").unbind("click");a("#btn_receive_donor").click(function(b){a(this).spin("small");
        a.post(mooConfig.url.base+"/fundraisings/receive_donor/",a("#formReceiveDonor").serialize(),function(b){b=a.parseJSON(b);"1"==b.result?window.location.reload():(a(".error-message").show(),a(".error-message").html(b.message));a("#btn_receive_donor").spin(!1)})})},initViewMap:function(){var b={zoom:15,center:new google.maps.LatLng(a("#map_canvas").attr("lat"),a("#map_canvas").attr("lng")),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map_canvas"),b);var d=
        new google.maps.InfoWindow,e=a("#map_canvas").attr("address");b=new google.maps.Marker({position:new google.maps.LatLng(a("#map_canvas").attr("lat"),a("#map_canvas").attr("lng")),map:map});google.maps.event.addListener(b,"click",function(a){return function(){d.setContent(e);d.open(map,a)}}(b))}}});